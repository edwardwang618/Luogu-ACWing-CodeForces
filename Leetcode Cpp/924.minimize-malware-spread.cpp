/*
 * @lc app=leetcode id=924 lang=cpp
 *
 * [924] Minimize Malware Spread
 */

// @lc code=start
class Solution {
public:
  int minMalwareSpread(vector<vector<int>> &g, vector<int> &ini) {
    int n = g.size();
    vector<int> p(n), sz(n, 1);
    iota(p.begin(), p.end(), 0);
    auto find = [&](auto &&find, int x) -> int {
      return p[x] == x ? x : p[x] = find(find, p[x]);
    };
    for (int i = 0; i < n; i++)
      for (int j = i + 1; j < n; j++)
        if (g[i][j] == 1) {
          int pi = find(find, i), pj = find(find, j);
          if (pi != pj) {
            p[pi] = pj;
            sz[pj] += sz[pi];
          }
        }
    int res = n + 1;
    unordered_map<int, int> cnt;
    for (int x : ini) {
      ++cnt[find(find, x)];
      res = min(res, x);
    }

    int max_sz = 0;
    for (int x : ini) {
      int px = find(find, x);
      if (cnt[px] == 1) { 
        if (max_sz < sz[px]) {
          res = x;
          max_sz = sz[px];
        } else if (max_sz == sz[px]) res = min(res, x);
      }
    }

    return res;
  }
};
// @lc code=end
